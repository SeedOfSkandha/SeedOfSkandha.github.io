<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>查询系统</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script>
        // 定义解密函数
        function decryptData(encryptedText, key) {
            let bytes = CryptoJS.AES.decrypt(encryptedText, key);
            let decryptedData = bytes.toString(CryptoJS.enc.Utf8);
            return decryptedData;
        }

        // 读取并解密文件内容
        async function fetchAndDecryptFiles(key) {
            let fileNames = ['encrypted-语文_小题分.js','encrypted-数学_小题分.js','encrypted-英语_小题分.js','encrypted-物理_小题分.js','encrypted-化学_小题分.js','encrypted-政治_小题分.js','encrypted-历史_小题分.js','encrypted-地理A2_小题分.js','encrypted-生物_小题分.js','encrypted-小语种_小题分.js'];  // 列出所有的加密文件名
            let decryptedDataList = [];

            for (let fileName of fileNames) {
                try {
                    let response = await fetch(fileName);
                    let text = await response.text();
                    let encryptedText = text.match(/const encryptedCSVData = "(.*)";/)[1];  // 提取加密字符串
                    let decryptedData = decryptData(encryptedText, key);
                    decryptedDataList.push(decryptedData);
                } catch (error) {
                    console.error(`Failed to load or decrypt file ${fileName}:`, error);
                }
            }

            return decryptedDataList;
        }

        // 查询功能
        async function queryData() {
            let name = document.getElementById("name").value;
            let examNumber = document.getElementById("examNumber").value;
            let key = "your-secret-key";  // 替换为实际的密钥

            let decryptedDataList = await fetchAndDecryptFiles(key);
            let resultArea = document.getElementById("result");

            resultArea.innerHTML = "";  // 清空之前的结果

            for (let data of decryptedDataList) {
                let lines = data.split("\n");
                for (let line of lines) {
                    let columns = line.split(",");
                    if (columns.length > 2 && columns[1] === examNumber && columns[2] === name) {
                        resultArea.innerHTML += `<p>${line}</p>`;
                    }
                }
            }

            if (resultArea.innerHTML === "") {
                resultArea.innerHTML = "<p>没有找到匹配的记录。</p>";
            }
        }
    </script>
</head>
<body>
    <h1>查询系统</h1>
    <label for="name">姓名：</label>
    <input type="text" id="name" name="name"><br>
    <label for="examNumber">准考证号：</label>
    <input type="text" id="examNumber" name="examNumber"><br>
    <button onclick="queryData()">查询</button>
    <div id="result"></div>
</body>
</html>
